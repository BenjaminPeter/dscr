# Makefile automatically generated by dscr::update_makefile
# https://github.com/stephens999/dscr/issues/3

PKGNAME := $(shell sed -n "s/Package: *\([^ ]*\)/\1/p" DESCRIPTION)
PKGVERS := $(shell sed -n "s/Version: *\([^ ]*\)/\1/p" DESCRIPTION)
PKGSRC  := $(shell basename `pwd`)

all: check clean

deps:
`r deps_str`

docs:
	R -q -e 'library("devtools"); document(".", roclets=c("rd", "collate", "namespace"))'

build:
	cd ..;\
	R CMD build --no-manual $(PKGSRC)

build-cran:
	cd ..;\
	R CMD build $(PKGSRC)

install: build
	cd ..;\
	R CMD INSTALL $(PKGNAME)_$(PKGVERS).tar.gz

check: build-cran
	cd ..;\
	R CMD check $(PKGNAME)_$(PKGVERS).tar.gz --as-cran

clean:
	cd ..;\
	$(RM) -r $(PKGNAME).Rcheck/

run-methods: install
`r run_methods_str`

# test before running since this involves recursive deletion
run-methods-clean:
`r run_methods_clean_str`

.PHONY: vignettes
vignettes: install
	cd vignettes;\
`r vignettes_str`

# test before running since this involves recursive deletion
.PHONY: vignettes-clean
vignettes-clean:
	cd vignettes || { echo "Cannot find the vignettes directory"; exit 1; } ;\
`r vignettes_clean_str`
